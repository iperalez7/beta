<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Warehouse Task Manager (PC)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"/>
  <style>
    body { font-family: 'Inter', sans-serif; background: #f0f2f5; }
    .fade-in { animation: fadeIn .4s; }
    @keyframes fadeIn { from { opacity: 0; transform: scale(0.98);} to { opacity: 1; transform: scale(1);} }
    .pulse { animation: pulse 0.7s; }
    @keyframes pulse { 0% { box-shadow: 0 0 0 0 #a7f3d0;} 70% { box-shadow: 0 0 0 10px rgba(16,185,129,0);} 100% { box-shadow: 0 0 0 0 rgba(16,185,129,0);} }
    .status-not-started { background: #ef4444; color: white; }
    .status-processing   { background: #f59e0b; color: white; }
    .status-ready        { background: #22c55e; color: white; }
    .status-shipped      { background: #64748b; color: white; }
    .scrolling-display { position: fixed; top:0; left:0; width:100vw; height:100vh; background:#e5e7eb; z-index:100; overflow:hidden; }
    .scrolling-inner-content { min-width: 100vw; }
  </style>
</head>
<body>
  <audio id="ding" src="https://cdn.pixabay.com/audio/2022/10/16/audio_12b7b6b7f1.mp3"></audio>
  <audio id="complete" src="https://cdn.pixabay.com/audio/2022/10/16/audio_12b7b6b7f1.mp3"></audio>
  <audio id="error" src="https://cdn.pixabay.com/audio/2022/10/16/audio_126b9a3a1c.mp3"></audio>
  <div id="main-view">
    <header class="bg-white shadow-md">
      <div class="max-w-7xl mx-auto py-6 px-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold text-gray-900">Warehouse Tasks (PC)</h1>
        <div>
          <button id="history-btn" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded mr-2">View History</button>
          <button id="scrolling-btn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Scrolling Display</button>
        </div>
      </div>
    </header>
    <div id="dashboard-view" class="main-container max-w-7xl mx-auto py-6 px-4 grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- Input Form -->
      <div class="card bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-semibold mb-4">Add New Task</h2>
        <form id="task-form">
          <div class="mb-3">
            <label class="block text-sm font-medium text-gray-700">Operation</label>
            <select id="operation" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" required>
              <option value="">Select...</option>
              <option>Get dimensions for future shipment</option>
              <option>Prepare pallets for shipping</option>
              <option>Prepare loose items for shipping</option>
              <option>Receive pallets from container</option>
              <option>Receive loose items from trailer</option>
              <option>Dispose of material</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="block text-sm font-medium text-gray-700">Details</label>
            <input type="text" id="details" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="Order ID, notes..." required>
          </div>
          <div class="mb-3">
            <label class="block text-sm font-medium text-gray-700">Quantity</label>
            <input type="number" id="quantity" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" min="1" required>
          </div>
          <div class="mb-3">
            <label class="block text-sm font-medium text-gray-700">Unit Type</label>
            <select id="unit-type" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
              <option>Pallets</option>
              <option>Loose Items</option>
              <option>Cartons</option>
              <option>Other</option>
            </select>
          </div>
          <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded">Add Task</button>
        </form>
      </div>
      <!-- Active Tasks -->
      <div>
        <h2 class="text-2xl font-bold mb-4 text-gray-800">Active Tasks</h2>
        <div id="tasks-list" class="space-y-4"></div>
      </div>
    </div>
    <!-- History -->
    <div id="history-view" class="hidden max-w-7xl mx-auto py-6 px-4">
      <h2 class="text-3xl font-bold mb-6 text-gray-800">Task History</h2>
      <div id="history-list" class="space-y-4"></div>
    </div>
  </div>
  <!-- Scrolling Display -->
  <div id="scrolling-view" class="scrolling-display hidden">
    <div class="fixed top-4 right-4 z-20">
      <button id="close-scrolling-btn" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">Close</button>
    </div>
    <div id="scrolling-content-wrapper" class="absolute top-0 left-0 w-full p-8"></div>
  </div>
  <!-- Edit Modal -->
  <div id="edit-modal" class="modal hidden fixed z-50 left-0 top-0 w-full h-full overflow-auto bg-black bg-opacity-40 flex items-center justify-center">
    <div class="bg-white p-8 rounded-lg max-w-lg w-full shadow-lg">
      <h2 class="text-xl font-semibold mb-4">Edit Task</h2>
      <form id="edit-form">
        <input type="hidden" id="edit-id">
        <div class="mb-3">
          <label class="block text-sm font-medium text-gray-700">Operation</label>
          <select id="edit-operation" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" required>
            <option>Get dimensions for future shipment</option>
            <option>Prepare pallets for shipping</option>
            <option>Prepare loose items for shipping</option>
            <option>Receive pallets from container</option>
            <option>Receive loose items from trailer</option>
            <option>Dispose of material</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="block text-sm font-medium text-gray-700">Details</label>
          <input type="text" id="edit-details" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" required>
        </div>
        <div class="mb-3">
          <label class="block text-sm font-medium text-gray-700">Quantity</label>
          <input type="number" id="edit-quantity" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" min="1" required>
        </div>
        <div class="mb-3">
          <label class="block text-sm font-medium text-gray-700">Unit Type</label>
          <select id="edit-unit-type" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
            <option>Pallets</option>
            <option>Loose Items</option>
            <option>Cartons</option>
            <option>Other</option>
          </select>
        </div>
        <div class="flex justify-end space-x-2">
          <button type="button" id="cancel-edit" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded">Cancel</button>
          <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded">Save</button>
        </div>
      </form>
    </div>
  </div>
  <script type="module">
    // --- Firebase Setup ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, updateDoc, deleteDoc, doc, serverTimestamp, query, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    const firebaseConfig = {
      apiKey: "AIzaSyCrm8kHsJu4Ly4IPQgRpPkNWYcDXLAl6qY",
      authDomain: "beta-644c6.firebaseapp.com",
      projectId: "beta-644c6",
      storageBucket: "beta-644c6.appspot.com",
      messagingSenderId: "991306765452",
      appId: "1:991306765452:web:bc9d004e17ef10b1c517a9"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    let currentUserId = null;
    let activeTasks = [], historyTasks = [];
    // --- Sounds ---
    function playSound(id) { try { document.getElementById(id).currentTime = 0; document.getElementById(id).play(); } catch{} }
    // --- Auth & Data ---
    onAuthStateChanged(auth, user => {
      if (user) {
        currentUserId = user.uid;
        listenForTasks();
      }
    });
    await signInAnonymously(auth);
    function listenForTasks() {
      const colRef = collection(db, "warehouse-tasks");
      onSnapshot(query(colRef, where("status", "!=", "shipped")), snap => {
        activeTasks = snap.docs.map(d => ({ id: d.id, ...d.data() }));
        renderTasks();
        renderScrolling();
      });
      onSnapshot(query(colRef, where("status", "==", "shipped")), snap => {
        historyTasks = snap.docs.map(d => ({ id: d.id, ...d.data() }));
        renderHistory();
      });
    }
    // --- Renderers ---
    function renderTasks() {
      const el = document.getElementById("tasks-list");
      el.innerHTML = "";
      if (!activeTasks.length) { el.innerHTML = `<div class="card text-center text-gray-500">No active tasks.</div>`; return; }
      activeTasks.forEach(task => {
        const div = document.createElement("div");
        div.className = `card rounded-lg shadow p-4 flex items-center justify-between fade-in status-${task.status}`;
        div.innerHTML = `
          <div>
            <div class="font-bold text-lg">${task.operation}</div>
            <div class="text-sm">${task.details}</div>
            <div class="text-xs">${task.quantity} ${task.unitType}</div>
          </div>
          <div class="flex items-center space-x-2">
            <button class="edit-btn bg-gray-200 hover:bg-gray-300 rounded px-2 py-1" data-id="${task.id}">✏️</button>
            <button class="delete-btn bg-red-200 hover:bg-red-400 rounded px-2 py-1" data-id="${task.id}">🗑️</button>
            <button class="status-btn bg-blue-200 hover:bg-blue-400 rounded px-2 py-1" data-id="${task.id}" title="Advance Status">⏩</button>
            <button class="ship-btn bg-green-200 hover:bg-green-400 rounded px-2 py-1" data-id="${task.id}" title="Mark as Shipped">🚚</button>
          </div>
        `;
        el.appendChild(div);
      });
    }
    function renderHistory() {
      const el = document.getElementById("history-list");
      el.innerHTML = "";
      if (!historyTasks.length) { el.innerHTML = `<div class="card text-center text-gray-500">No shipped tasks.</div>`; return; }
      historyTasks.forEach(task => {
        const shippedDate = task.shippedAt?.toDate?.().toLocaleString() || "";
        const div = document.createElement("div");
        div.className = "card bg-slate-100 flex justify-between items-center";
        div.innerHTML = `<div><b>${task.operation}</b><br><span class="text-sm">${task.details}</span></div>
          <div class="text-xs text-gray-500">Shipped: ${shippedDate}</div>`;
        el.appendChild(div);
      });
    }
    function renderScrolling() {
      const wrapper = document.getElementById("scrolling-content-wrapper");
      if (!activeTasks.length) { wrapper.innerHTML = `<div class="text-3xl text-gray-400 text-center mt-40">No pending tasks</div>`; return; }
      wrapper.innerHTML = `<div class="scrolling-inner-content space-y-8">${activeTasks.map(task => `
        <div class="rounded-xl shadow-xl p-8 mb-6 text-4xl font-bold flex flex-col items-center status-${task.status} fade-in">
          <div>${task.operation}</div>
          <div class="text-2xl font-normal">${task.details}</div>
          <div class="text-lg">${task.quantity} ${task.unitType}</div>
          <div class="text-base uppercase tracking-wider">${task.status.replace('-',' ')}</div>
        </div>
      `).join('')}</div>`;
      // Animate scroll
      setTimeout(() => {
        const inner = wrapper.querySelector('.scrolling-inner-content');
        if (!inner) return;
        const h = inner.offsetHeight, vh = window.innerHeight;
        if (h > vh) {
          wrapper.style.animation = `scrolling ${h/30}s linear infinite`;
          let style = document.getElementById('scrolling-style');
          if (style) style.remove();
          style = document.createElement('style');
          style.id = 'scrolling-style';
          style.innerHTML = `@keyframes scrolling { 0%{transform:translateY(0);} 100%{transform:translateY(-${h-vh+100}px);} }`;
          document.head.appendChild(style);
        } else {
          wrapper.style.animation = '';
        }
      }, 100);
    }
    // --- Form Actions ---
    document.getElementById("task-form").onsubmit = async e => {
      e.preventDefault();
      const operation = document.getElementById("operation").value;
      const details = document.getElementById("details").value;
      const quantity = +document.getElementById("quantity").value;
      const unitType = document.getElementById("unit-type").value;
      try {
        await addDoc(collection(db, "warehouse-tasks"), {
          operation, details, quantity, unitType, status: "not-started", createdAt: serverTimestamp()
        });
        playSound("ding");
        e.target.reset();
      } catch { playSound("error"); }
    };
    document.getElementById("tasks-list").onclick = async e => {
      const id = e.target.dataset.id;
      if (e.target.classList.contains("edit-btn")) openEditModal(id);
      if (e.target.classList.contains("delete-btn")) {
        if (confirm("Delete this task?")) {
          await deleteDoc(doc(db, "warehouse-tasks", id));
          playSound("error");
        }
      }
      if (e.target.classList.contains("status-btn")) {
        const task = activeTasks.find(t => t.id === id);
        const next = task.status === "not-started" ? "processing" : task.status === "processing" ? "ready" : "not-started";
        await updateDoc(doc(db, "warehouse-tasks", id), { status: next });
        playSound("ding");
      }
      if (e.target.classList.contains("ship-btn")) {
        await updateDoc(doc(db, "warehouse-tasks", id), { status: "shipped", shippedAt: serverTimestamp() });
        playSound("complete");
      }
    };
    // --- Edit Modal ---
    function openEditModal(id) {
      const t = activeTasks.find(x => x.id === id);
      if (!t) return;
      document.getElementById("edit-id").value = t.id;
      document.getElementById("edit-operation").value = t.operation;
      document.getElementById("edit-details").value = t.details;
      document.getElementById("edit-quantity").value = t.quantity;
      document.getElementById("edit-unit-type").value = t.unitType;
      document.getElementById("edit-modal").classList.remove("hidden");
    }
    document.getElementById("cancel-edit").onclick = () => document.getElementById("edit-modal").classList.add("hidden");
    document.getElementById("edit-form").onsubmit = async e => {
      e.preventDefault();
      const id = document.getElementById("edit-id").value;
      await updateDoc(doc(db, "warehouse-tasks", id), {
        operation: document.getElementById("edit-operation").value,
        details: document.getElementById("edit-details").value,
        quantity: +document.getElementById("edit-quantity").value,
        unitType: document.getElementById("edit-unit-type").value
      });
      playSound("ding");
      document.getElementById("edit-modal").classList.add("hidden");
    };
    // --- Scrolling Display ---
    document.getElementById("scrolling-btn").onclick = () => {
      document.getElementById("main-view").classList.add("hidden");
      document.getElementById("scrolling-view").classList.remove("hidden");
      renderScrolling();
    };
    document.getElementById("close-scrolling-btn").onclick = () => {
      document.getElementById("main-view").classList.remove("hidden");
      document.getElementById("scrolling-view").classList.add("hidden");
    };
    // --- History Toggle ---
    document.getElementById("history-btn").onclick = () => {
      const hv = document.getElementById("history-view");
      const dv = document.getElementById("dashboard-view");
      if (hv.classList.contains("hidden")) {
        hv.classList.remove("hidden"); dv.classList.add("hidden");
        document.getElementById("history-btn").textContent = "Back to Dashboard";
      } else {
        hv.classList.add("hidden"); dv.classList.remove("hidden");
        document.getElementById("history-btn").textContent = "View History";
      }
    };
  </script>
</body>
</html>
